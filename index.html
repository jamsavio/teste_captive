<!--- Created by @jamsaavio -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Conectar - WiFi Casa Vieira</title>
<style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      margin: 0;
      padding: 0;
      background-color: #E0F2F1; /* Cor de fundo opaco */
    }

    .container {
      max-width: 400px;
      margin: 50px auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 10px; /* Borda arredondada */
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1); /* Sombra */
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      color: #333;
    }

    input[type="text"],
    input[type="tel"] {
      width: calc(100% - 20px); /* Largura total com margem */
      padding: 12px;
      border: 1px solid #d1d1d6; /* Cor da borda */
      border-radius: 8px; /* Borda arredondada */
      background-color: #f2f2f7; /* Cor de fundo */
    }

    button {
      width: 100%;
      background-color: #009238; /* Cor do bot√£o */
      color: #fff;
      border: none;
      padding: 12px;
      border-radius: 8px; /* Borda arredondada */
      cursor: pointer;
    }

    button:hover {
      background-color: #007a2f;
    }

    /* Estilo para checkbox no formato iOS */
    .ios-checkbox .form-check-input {
      width: 20px; /* Largura do checkbox */
      height: 20px; /* Altura do checkbox */
      margin-right: 5px; /* Espa√ßamento entre o checkbox e o texto */
      vertical-align: middle; /* Alinhar verticalmente com o texto */
    }

    .ios-checkbox .form-check-label.small {
      font-size: 14px; /* Tamanho do texto pequeno */
      vertical-align: middle; /* Alinhar verticalmente com o checkbox */
      display: inline-block; /* Permitir que o texto fique ao lado do checkbox */
    }
</style>

<script>
  (function (window, document, defaultUrl) {
      'use strict';

      var nebula = {};

      // Parsing URL query parameters
      function parseQueryParameters() {
          var params = {};
          var query = window.location.search.substr(1);
          query.split('&').forEach(function (param) {
              var item = param.split('=');
              params[item[0]] = decodeURIComponent(item[1]);
          });
          return params;
      }

      nebula.params = parseQueryParameters();

      // Get the callback URL
      nebula.acquireCallbackUrl = function () {
          var postUrl = nebula.params.url || defaultUrl;
          return postUrl;
      };

      // Validate the URL
      window.isUrlValid = function (url) {
          try {
              var urlObj = new URL(url);
              return /^https?:$/.test(urlObj.protocol);
          } catch (e) {
              return false;
          }
      };

      // Handle form submission
      nebula.submitEvent = function (e) {
          var postURL = nebula.acquireCallbackUrl();
          if (postURL && !window.isUrlValid(postURL)) {
              e.preventDefault();
              alert('URL inv√°lido. Por favor, tente novamente.');
              return false;
          }
          // Disable the submit button
          document.getElementById('submit-btn').setAttribute('disabled', 'disabled');
          window.setTimeout(function () {
              document.getElementById('submit-btn').removeAttribute('disabled');
          }, 5000);

          // Redirect to the specific URL after successful submission
          var redirectUrl = 'https://www.casavieira.com.br/inicial';
          window.location.href = redirectUrl;

          return true;
      };

      window.NEBULA = nebula;

  })(window, window.document, '/default.cgi');
</script>
</head>
<body>
  <div class="container">
    <span style="font-family: Segoe UI; font-size: 26px">Conectar no WiFi - Casa Vieira</span><h2></h2>

    <form method="post" autocomplete="off" name="google-sheet" id="google-sheet" action="javascript:;" onsubmit="NEBULA.submitEvent(event)">
      <div class="form-group">
        <label for="name">Nome:</label>
        <input type="text" id="name" name="Nome" required>
      </div>
      <div class="form-group">
        <label for="phone">N√∫mero de Telefone:</label>
        <input type="tel" id="phone" name="Contato" pattern="\([0-9]{2}\) [0-9]{5}-[0-9]{4}" required>
      </div>
      <input type="hidden" id="Data" name="Data">

      <div class="form-group ios-checkbox">
        <div class="form-check">
          <table>
            <td><input class="form-check-input" type="checkbox" id="whatsappOptIn" name="Termo de consentimento do uso dos dados" value="Aceito" checked></td>
            <td><label class="form-check-label small" for="whatsappOptIn"><b>Quero receber ofertas exclusivas da loja via WhatsApp.</b> Entendemos que sua privacidade √© importante, e seus dados estar√£o em ambiente seguro. Voc√™ pode cancelar o recebimento dessas ofertas a qualquer momento.</label></td>
          </table>
        </div>
      </div>      

      <input name="redirurl" type="hidden" value="$PORTAL_REDIRURL$">
      <input name="zone" type="hidden" value="$PORTAL_ZONE$">
      <button name="accept" type="submit">Entrar</button>
      
    </form>
  </div>

  <script>
    document.getElementById('phone').addEventListener('input', function(event) {
        const phoneInput = event.target;
        const phone = phoneInput.value.replace(/\D/g, ''); // Remove caracteres n√£o num√©ricos
        const formattedPhone = formatPhoneNumber(phone);
        phoneInput.value = formattedPhone;
    });
    
    function formatPhoneNumber(phone) {
        const match = phone.match(/^(\d{0,2})(\d{0,5})(\d{0,4})$/);
        if (match[1] && !match[2]) {
        return `(${match[1]}`;
        } else if (match[1] && match[2] && !match[3]) {
        return `(${match[1]}) ${match[2]}`;
        } else if (match[1] && match[2] && match[3]) {
        return `(${match[1]}) ${match[2]}-${match[3]}`;
        }
        return phone;
    }

    function formatDate(date) {
        const day = ("0" + date.getDate()).slice(-2);
        const month = ("0" + (date.getMonth() + 1)).slice(-2);
        const year = date.getFullYear();
        const hours = ("0" + date.getHours()).slice(-2);
        const minutes = ("0" + date.getMinutes()).slice(-2);
        return `${day}/${month}/${year} ${hours}:${minutes}`;
    }

    // Fun√ß√£o para criar um cookie permanente
    function createCookie(name, value, days) {
        let expires = "";
        if (days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }

    // Fun√ß√£o para ler o cookie
    function readCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for(let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    // Verifica se o cookie existe
    const visitedCookie = readCookie('visited');
    const container = document.querySelector('.container');

    if (visitedCookie) {
        container.innerHTML = '<p style="font-size: 20px; text-align: center;"><b>CONECTADO!</b> Obrigado por nos visitar. ü§ù</p>';
        NEBULA.submitEvent(event);
    } else {
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzt82sKn-PqdFuMYK2WMZEaQ13GNNgJnBGeHl5pN4rKdaRUXf2qRWzHtlThsB-PqnpR/exec'
        const form = document.forms['google-sheet']

        const timestamp = new Date();
        const formattedTimestamp = formatDate(timestamp);
        document.getElementById('Data').value = formattedTimestamp;

        form.addEventListener('submit', e => {
            e.preventDefault();
            createCookie('visited', 'true', 1095); // Cria o cookie de 3 anos (1095 dias)

            const whatsappOptInCheckbox = document.getElementById('whatsappOptIn');
            if (!whatsappOptInCheckbox.checked) {
                alert("CONECTADO! Obrigado por nos visitar. ü§ù")
                return; 
            }

            fetch(scriptURL, { method: 'POST', body: new FormData(form)})
            .then(response => alert("CONECTADO! Obrigado por nos visitar. ü§ù"))
            .catch(error => console.error('Error!', error.message))
        });
    }
  </script>

  <script>
    (function (window, document, nebula) {
        'use strict';
        // Set the form action URL
        var postURL = nebula.acquireCallbackUrl();
        if (postURL) {
            document.getElementById('loginform').action = postURL;
        }
    })(window, window.document, window.NEBULA);
  </script>
</body>
</html>
